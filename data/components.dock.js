var Dock=function(n,t){var l,s,e;function o(){function e(n,t){var e=r(n),o=!1;t.each(function(){$(this).is(":checked")&&(e.show(),o=!0)}),o||e.hide(),(l.mainDock.is("table")&&!o?u:f)()}var n=l.mainDock.is("table")?l.mainDock:l.subDocks;n.each(function(){var t=$(),n=$(this);if(!n.hasClass("auto-hide-buttons"))return!0;n.find("TR").each(function(){var n=$(this).find("TD:visible").first().find("INPUT[type=checkbox]");n.length&&(t=t.add(n))}),e(n,t),t.off("click.dockclick"),t.on("click.dockclick",function(){e(n,t)})})}function c(){throw new Error("Dock: No usable buttonset found.")}function r(n){var t=n.children("DIV").last();return s.buttonset&&1===s.buttonset.length?i(s.buttonset):a(t)?i(t):a(t=n.next())||n.is("table")&&n.parent().is(".table-responsive")&&a(t=n.parent().next())?n.is(l.mainDock)?i(t):t:null}function a(n){return 0<n.find("button, input[type=submit], input[type=button], a[role=button]").length}function i(n){return n.parent().hasClass("dock-buttons-wrapper")||n.hasClass("dock-buttons-wrapper")||n.wrap($("<div />").addClass("dock-buttons-wrapper")),n.hasClass("dock-buttons-wrapper")?n:n.parent()}function d(n){"function"==typeof n&&n()}function u(){var n;l.floating.hasClass("dock-floating")&&(l.floating.removeClass("dock-floating").css({position:"",width:"",left:""}),(n=l.floating.find(".pull-right")).removeClass("pull-right"),e||n.removeClass("horizontal-link-container"),d(s.onUndock),$(".savehide").addClass("feedbackTemplateDiv-beforeDocking"),$(".dock-buttons-wrapper").removeClass("feedbackTemplateDiv-Docked"),$(".savehide").addClass("horizontal-link-container"))}function f(){var n,i=l.parentSidepanel?l.parentSidepanel.scrollTop()+document.documentElement.clientHeight:$(window).scrollTop()+document.documentElement.clientHeight,t=l.mainDock.offset().top;!((t=l.parentSidepanel?(t-=$(window).scrollTop())+l.parentSidepanel.scrollTop():t)+l.mainDock.height()<i)&&t<i?(l.floating.hasClass("dock-floating")||(l.floating.addClass("dock-floating").css({position:"fixed"}),!l.mainDock.is(".customcontent")&&(l.mainDock.is("form")||l.mainDock.is("div")||l.parentSidepanel&&!l.mainDock.is("table"))?(t=l.floating.children(),e=t.hasClass("horizontal-link-container"),t.addClass("pull-right horizontal-link-container")):l.mainDock.is(".customcontent")||l.floating.children().addClass("pull-left"),d(s.onDock),l.table&&void 0!==l.table.scrollFloat&&l.table.scrollFloat.setBottom(l.floating.outerHeight())),t=$(".feedback-frame").length,n=parseInt($(".container").css("padding-left"),10),0<t&&0<n?(l.floating.css({width:l.mainDock.width()-4*n+"px",left:parseInt(l.mainDock.offset().left)+2*n}),$(".savehide").removeClass("feedbackTemplateDiv-beforeDocking"),$(".dock-buttons-wrapper").addClass("feedbackTemplateDiv-Docked")):l.floating.css({width:l.mainDock.width(),left:l.mainDock.offset().left}),0<l.subDocks.length&&l.subDocks.each(function(n){var t=$(this),e=t.offset().top,o=e<i,e=e+t.height()<i,t=r(t),a=l.floating.find(".clone[data-clone-index="+n+"]");if(null===t&&c(),!t.is(":visible"))return 0<a.length&&a.remove(),!0;!e&&o?0===a.length&&((a=t.children().first().clone(!0)).addClass("clone pull-left no-margin").removeAttr("style").removeAttr("id").attr("data-clone-index",n).prependTo(l.floating),d(s.onDockSub)):0<a.length&&(a.remove(),t.show(),d(s.onUndockSub))})):u()}return void 0===t&&(t={}),s=$.extend(!0,{},{buttonset:null,onDock:null,onUndock:null,onDockSub:null,onUndockSub:null},t),t={trigger:function(){u(),f()},reset:function(){o()}},(l={}).mainDock=n,l.mainDock.addClass("dock"),l.parentSidepanel=l.mainDock.parents(".sidepanel"),0===l.parentSidepanel.length&&(l.parentSidepanel=null),l.subDocks=n.find(".dock"),l.subDocks.addClass("sub-dock"),"string"==typeof s.buttonset&&(s.buttonset=$(s.buttonset)),l.floating=null,l.floating=r(l.mainDock),null===l.floating&&c(),l.mainDock[0].dock=t,o(),(l.parentSidepanel||$(window)).on("scroll resize",f),l.table=l.mainDock.closest("table"),0<l.table.length?l.table=l.table[0]:delete l.table,f(),t};