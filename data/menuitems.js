var langNo=document.documentElement?{fi:0,sv:1,en:2}[document.documentElement.lang]:0,MenuItems={movingLink:null,movingLinkReplica:null,startX:null,startY:null,moveAtX:0,moveAtY:0,movingLinkOffsetX:null,movingLinkOffsetY:null,linkMenuMids:null,hiddenLinkBox:null,hiddenLinkMids:null,lastOpener:null,distanceFromStart:0,maxDistanceFromStart:0,RightColStatus:{hidden:!1,origWidth:"32%",origleftColWidth:"68%"},translations:{toiminnot:["Toiminnot","Funktioner","Functions"][langNo],tulosteet:["Tulosteet","Utskrifter","Printouts"][langNo],lomakkeet:["Lomakkeet","Blanketter","Forms"][langNo],lisaa:["Lisää","Mera","More"][langNo],edellinen:["Edellinen","Föregående","Previous"][langNo],seuraava:["Seuraava","Nästa","Next"][langNo],sulje:["Sulje","Stäng","Close"][langNo]},toggleHiddenLinkBox:function(e){e.preventDefault();var t,n,e=e.target||e.srcElement,i="visible"===(t=$(e).hasClass("panel-btn")||$(e).parent().hasClass("panel-btn")?($(e).hasClass("panel-btn")||(e=$(e).parent()),i=$(e).attr("class").split(" ")[1],$(document.body).find("DIV."+i)):$(e).hasClass("switch")?$('DIV.hidden-links.switch[data-order="'+$(e).data("order")+'"]'):$('DIV.hidden-links[data-order="'+$(e).data("order")+'"]')).css("visibility");t.css("visibility","hidden"),i?($("html").off("mouseup"),t.css("visibility","hidden")):(MenuItems.lastOpener=e,MenuItems.lastOpener instanceof jQuery||(MenuItems.lastOpener=$(MenuItems.lastOpener)),t.css("visibility","visible"),t.find("A").length&&t.focus(),(t.hasClass("right-col")||t.hasClass("switch"))&&(i=versionOfIE(),n=$(e).offset().top+$(e).outerHeight(!0),7==i||8==i?(t.width(150),t.css("background-color","#323232"),t.css({top:n,left:$(e).offset().left})):(i=$(e).offset().left+$(e).outerWidth(!0)-t.outerWidth(!1),t.css({top:n,left:i}))),$("html").on("mouseup",function(e){e=e.target||e.srcElement;e!==t.get(0)&&$(e).parent().get(0)!==t.get(0)&&e!==MenuItems.lastOpener.get(0)&&$(e).parent().get(0)!==MenuItems.lastOpener.get(0)&&($("html").off("mouseup"),t.css("visibility","hidden"))}))},handleMouseOut:function(e){var t=$("DIV.cats:visible"),n=t.attr("id").slice(-1),n=$("DIV.section").find('[data-cat="'+n+'"]'),i=t.offset().left,s=t.offset().left+t.width(),o=t.offset().top,a=t.offset().top+t.height(),d=n.offset().left-parseInt(n.css("margin-left"),10),r=n.offset().left+n.width()+parseInt(n.css("margin-right"),10)+10,l=n.offset().top-parseInt(n.css("margin-top"),10),n=n.offset().top+$("DIV.section").height()+10,h=e.pageX||e.clientX,m=e.pageY||e.clientY;(h<i||s<h||m<o||a<m)&&(h<d||r<h||m<l||n<m)&&(t.hide(),$("html").off(e.type,this.handleMouseOut))},handleMenuItems:function(s){function e(){var e,t,n,i;s.parent("DIV").length&&(s.parent("DIV").hasClass("tabs")?(i=s.parent("DIV").hasClass("alttabs")?"alttabs":"tabs",u.addClass(i+"-linkbox"),e=(i=$("DIV."+i+" > DIV.section.dynamic-menu > A").length?$("DIV."+i+" > DIV.section.dynamic-menu > A"):$("DIV."+i+" > DIV.section.dynamic-menu > SPAN")).offset().top,t=i.position().top,n=i.height(),i=parseInt(i.css("padding-bottom"),10),u.css("top",e+n+i),s.siblings("A.hidden-links-opener").addClass("tabs").css("top",t)):s.parent("DIV").attr("id")&&u.addClass(s.parent("DIV").attr("id")+"-linkbox")),u.hasClass("l-menu-linkbox")&&s.siblings("A.hidden-links-opener").addClass("l-menu")}var t=$(window).innerWidth()||document.documentElement.clientWidth||document.body.clientWidth;if(!(s.parent("DIV.tabs").length&&s.parent("DIV.tabs").width()>$(window).width())){s.css("width",t-parseInt(s.css("margin-right"),10)+"px");var n,i=s.width(),o=($(document).height()>$(window).height()&&(i-=15),s.find("A:not(.hidden-links-opener), B:not(.hidden-links-opener), SPAN")),a=parseInt(o.first().css("margin-left"),10)+parseInt(o.first().css("margin-right"),10),d=parseInt(o.first().css("padding-left"),10)+parseInt(o.first().css("padding-right"),10),r=0,l=0,h=[],m=(o.each(function(){var e=$(this).width()+a+d;i<r+e&&1<o.length?h.push($(this)):l+=e,r+=e}),0),u=($("DIV.section.dynamic-menu").each(function(){if(m++,this===s.get(0))return!1}),$('DIV.hidden-links[data-order="'+m+'"]'));if(h.length){u.length||(u=$("<DIV></DIV>").attr({class:"hidden-links","data-order":m}).css("visibility","hidden"),$(document.body).append(u),$(s).parent().find("A.hidden-links-opener").length||s.parent().append($("<A>"+MenuItems.translations.lisaa+"</A>").addClass("hidden-links-opener").attr({href:"#","data-order":m}).click(MenuItems.toggleHiddenLinkBox)),e(),$(window).resize(e));for(var c=h.length-1;0<=c;c--)h[c].animate({opacity:0},0),u.prepend(h[c]),h[c].animate({opacity:1},400);u.css({maxHeight:$(window).height()-u.offset().top})}else for(;0<u.children().length;){var f=u.children().first(),p=(n=void 0,"block"===(p=f).css("display")?((p=p.clone(!0)).css({position:"absolute",left:"-9999px",display:"inline-block","font-size":"11px"}),p.appendTo("body"),n=p.width(),p.remove(),n):0);if(!(l+p+a+d<i))break;f.animate({opacity:0},0),s.append(f),f.animate({opacity:1},400),l+=s.children().last().width()+a+d}u.children().length?o.length||s.append(u.children().first()):(u.remove(),s.siblings("A.hidden-links-opener").off("click",MenuItems.toggleHiddenLinkBox).remove())}},copyStyles:function(e,t,n){for(var i=0;i<n.length;i++)t.css(n[i],e.css(n[i]))},initLinkDrag:function(){this.movingLinkReplica=$(this.movingLink).clone(!0),this.movingLinkOffsetX=this.startX-$(this.movingLink).offset().left,this.movingLinkOffsetY=this.startY-$(this.movingLink).offset().top;var e=$("A.hidden-links-opener.l-menu").data("order");this.hiddenLinkBox=$('DIV.hidden-links[data-order="'+e+'"]'),this.sectionDims={top:$("#l-menu > .section").offset().top,bottom:$("#l-menu > .section").offset().top+$("#l-menu > .section").height()},this.linkMenuMids=[],$("#l-menu > .section").find("a,b").each(function(){MenuItems.linkMenuMids.push($(this).offset().left+Math.round($(this).width()/2))}),this.hiddenLinkBox.is(":visible")&&(this.hiddenLinkMids=[],this.hiddenLinksDims={top:this.hiddenLinkBox.offset().top,bottom:this.hiddenLinkBox.offset().top+this.hiddenLinkBox.height(),left:this.hiddenLinkBox.offset().left,right:this.hiddenLinkBox.offset().left+this.hiddenLinkBox.width()},this.hiddenLinkBox.find("a,b").each(function(){MenuItems.hiddenLinkMids.push($(this).offset().top+Math.round($(this).height()/2))}));this.copyStyles($(this.movingLink),this.movingLinkReplica,["height","font-size","font-family","padding-top","padding-bottom"]),$("html").prepend(this.movingLinkReplica),this.movingLinkReplica.addClass("link-replica"),this.movingLinkReplica.css({"z-index":200,display:"block",position:"absolute",top:this.startY-this.movingLinkOffsetY+"px",left:this.startX-this.movingLinkOffsetX+"px"})},linkDragStart:function(e){3!==e.which&&2!==e.which&&(e.preventDefault(),this.movingLink=e.target||e.srcElement,this.startX=e.pageX||e.clientX,this.startY=e.pageY||e.clientY,$(document).on("mousemove",this.linkDragAction),$(document).on("mouseup",this.linkDragEnd))},linkDragAction:function(e){function t(e,t,n){e=$(e);$("DIV.marker, DIV.marker-horizontal").remove(),"prepend"===t?e.before($("<DIV></DIV>").addClass(n?"marker-horizontal":"marker")):e.after($("<DIV></DIV>").addClass(n?"marker-horizontal":"marker"))}if(e.preventDefault(),MenuItems.movingLinkReplica||MenuItems.initLinkDrag(),MenuItems.moveAtX=e.pageX||e.clientX,MenuItems.moveAtY=e.pageY||e.clientY,MenuItems.distanceFromStart=Math.round(Math.sqrt(Math.pow(Math.abs(MenuItems.moveAtX-MenuItems.startX),2)+Math.pow(Math.abs(MenuItems.moveAtY-MenuItems.startY),2))),MenuItems.maxDistanceFromStart=Math.max(MenuItems.distanceFromStart,MenuItems.maxDistanceFromStart),MenuItems.moveAtY>MenuItems.sectionDims.top&&MenuItems.moveAtY<MenuItems.sectionDims.bottom&&5<MenuItems.distanceFromStart)for(var n=0;n<MenuItems.linkMenuMids.length;n++){if(0===n&&MenuItems.moveAtX<MenuItems.linkMenuMids[n]){t($("#l-menu > .section").find("a,b")[n],"prepend",!1);break}if(n===MenuItems.linkMenuMids.length-1&&MenuItems.moveAtX>MenuItems.linkMenuMids[n]){t($("#l-menu > .section").find("a,b")[n],"append",!1);break}if(MenuItems.moveAtX>MenuItems.linkMenuMids[n]&&MenuItems.moveAtX<MenuItems.linkMenuMids[n+1]){t($("#l-menu > .section").find("a,b")[n],"append",!1);break}}else $("DIV.marker").remove();if(null!==MenuItems.hiddenLinkMids&&5<MenuItems.distanceFromStart)if(MenuItems.moveAtY>MenuItems.hiddenLinksDims.top&&MenuItems.moveAtY<MenuItems.hiddenLinksDims.bottom&&MenuItems.moveAtX>MenuItems.hiddenLinksDims.left&&MenuItems.moveAtX<MenuItems.hiddenLinksDims.right)for(n=0;n<MenuItems.hiddenLinkMids.length;n++){if(0===n&&MenuItems.moveAtY<MenuItems.hiddenLinkMids[n]){t(MenuItems.hiddenLinkBox.find("a,b")[n],"prepend",!0);break}if(n===MenuItems.hiddenLinkMids.length-1&&MenuItems.moveAtY>MenuItems.hiddenLinkMids[n]){t(MenuItems.hiddenLinkBox.find("a,b")[n],"append",!0);break}if(MenuItems.moveAtY>MenuItems.hiddenLinkMids[n]&&MenuItems.moveAtY<MenuItems.hiddenLinkMids[n+1]){t(MenuItems.hiddenLinkBox.find("a,b")[n],"append",!0);break}}else $("DIV.marker-horizontal").remove();MenuItems.movingLinkReplica.css({top:MenuItems.moveAtY-MenuItems.movingLinkOffsetY+"px",left:MenuItems.moveAtX-MenuItems.movingLinkOffsetX+"px"})},linkDragEnd:function(e){e.preventDefault(),$(document).off("mousemove",MenuItems.linkDragAction),$(document).off("mouseup",MenuItems.linkDragEnd),MenuItems.startX=null,MenuItems.startY=null,MenuItems.movingLinkOffsetX=null,MenuItems.movingLinkOffsetY=null,MenuItems.linkMenuMids=null,MenuItems.hiddenLinkMids=null,MenuItems.pixelsTraveled=0,MenuItems.movingLinkReplica&&MenuItems.movingLinkReplica.remove(),MenuItems.movingLinkReplica=null,$("#l-menu").find("DIV.marker").length||MenuItems.hiddenLinkBox&&MenuItems.hiddenLinkBox.find("DIV.marker-horizontal").length?(($("DIV.marker").length?($("#l-menu").find("DIV.marker").after(MenuItems.movingLink),$("DIV.marker")):(MenuItems.hiddenLinkBox.find("DIV.marker-horizontal").after(MenuItems.movingLink),$("DIV.marker-horizontal"))).remove(),MenuItems.saveLinkOrder(),$("DIV.dynamic-menu").each(function(){MenuItems.handleMenuItems($(this))})):MenuItems.maxDistanceFromStart<5&&("undefined"!=typeof leaveConfirm&&leaveConfirm.needConfirm()||(location.href=MenuItems.movingLink.href)),MenuItems.distanceFromStart=0,MenuItems.maxDistanceFromStart=0,MenuItems.hiddenLinkBox=null},saveLinkOrder:function(){var e={},t=[],n=($("#l-menu > .section").find("a,b").each(function(){var e=$(this).data("path");t.push(e)}),MenuItems.hiddenLinkBox.find("a,b").each(function(){var e=$(this).data("path");t.push(e)}),e.links=1,e.neworder=t.toString(),e.formkey=$("input[name=formkey]").val(),getRolePrefix()+"/preferences/savelinkorder");$.ajax({type:"POST",url:n,data:e})},saveFrontpageOrder:function(){function e(n){n.find("DIV.resp-box").each(function(){var e,t;$(this).hasClass("empty")||(e=$(this).data("path"),t=n.hasClass("left")?"left":"right",i.push('"'+e+'":{"col":"'+t+'"}'))})}var t={},i=[],n=(e($("DIV.resp-column.left")),e($("DIV.resp-column.right")),t.frontpage=1,t.neworder="{"+i.toString()+"}",t.formkey=$("input[name=formkey]").val(),getRolePrefix()+"/preferences/savelinkorder");$.ajax({type:"POST",url:n,data:t})},initColumnMinimize:function(e){var t;e.children().length&&(t=$("<DIV></DIV>").attr({class:"col-min-btn"}),e.prepend(t),t.on("click",function(){MenuItems.toggleRightCol(e)}))},toggleRightCol:function(e){var t,n=e.find("DIV.col-min-btn");!1===this.RightColStatus.hidden?(this.RightColStatus.hidden=!0,t=e.clone(!1),e.before(t),e.children(":not(.col-min-btn)").hide(),e.css("width","15px"),t.animate({width:"15px",position:"absolute",overflow:"hidden"},{duration:200,queue:!1,complete:function(){t.remove(),n.addClass("reverse")}}),t.animate({height:"15px"},{duration:150,queue:!1}),$("DIV.columns-left").length&&$("DIV.columns-left").animate({width:$(window).width()-55},{duration:250,queue:!0})):!0===this.RightColStatus.hidden&&(e.animate({height:"",width:this.RightColStatus.origWidth},{duration:250,queue:!1,complete:function(){e.children().show(),n.removeClass("reverse")}}),this.RightColStatus.hidden=!1,$("DIV.columns-left").length)&&$("DIV.columns-left").animate({width:this.RightColStatus.origleftColWidth},{duration:200,queue:!0})},switchToPopup:function(){var o=0;$("P.switch.popup-menu").each(function(){var e,t,n=$(this),i=(void 0!==n.data("parent-tab")&&""!==n.data("parent-tab")&&(e=n.data("parent-tab"),(i=$($(document.body).find("DIV.tabs")[e.tabset-1])).length)&&(t=$(i.find("A,B,SPAN")[e.tab-1])).length&&""!==e.altloc&&t.text(e.altloc),n.find("B")),s=(i.removeClass("tabbed"),i.attr({"data-order":o,class:"hidden-links-opener switch"}).click(MenuItems.toggleHiddenLinkBox),$("<DIV></DIV>").attr({"data-order":o,class:"hidden-links switch"}).css("visibility","hidden"));n.find("A").each(function(){s.append(this)}),$(document.body).append(s),i.siblings().remove(),void 0!==t&&t.length?(t.append(i),i.parents("div.alttabs").length&&(e=$("<span />").addClass("alttabs-dropdown"),t=i.parent(),i.appendTo(e),t.after(e)),n.remove()):n.show(),o++})},fixContentHeader:function(){var e=$("DIV#l-content-header"),t=e.find(".inner");e.length&&t.children().length||window.top!==window.self?window.top!==window.self&&e.length&&e.remove():$("DIV#l-content")},fixHeaderPosition:function(){},arrangeMainPageCols:function(){var e;$("DIV.exclamation-leader").length&&(e=parseInt($("DIV.container").css("top"),10),$("DIV.exclamation-leader").each(function(){e+=$(this).outerHeight()}),$("DIV.container").css("top",e));var t=[],n=[];if($("INPUT#custom-frontpage-order").length){var i,s,o=JSON.parse($("INPUT#custom-frontpage-order").val()),a=o.hasOwnProperty("Calendar");for(s in o.hasOwnProperty("Critical")||(i=$("DIV.resp-box[data-path=Critical]"),t.push(i)),o)if(void 0!==s)switch(0!==(i=$("DIV.resp-box[data-path="+s+"]")).length||"ShowCompactTimetable"!==s||a||(i=$("DIV.resp-box[data-path=Calendar]")),o[s].col){case"left":case"middle":t.push(i);break;case"right":n.push(i)}var d=$("<div />").addClass("resp-box").addClass("empty");for(t.length||$("DIV.resp-column.left").append(d),n.length||$("DIV.resp-column.right").append(d),s=0;s<t.length;s++)$("DIV.resp-column.left").append(t[s]);for(s=0;s<n.length;s++)$("DIV.resp-column.right").append(n[s])}for(var r,l="";$("DIV.row").children("DIV.resp-box").length;)r=void 0,r=$("DIV.row").children("DIV.resp-box:first"),l=""===l||"right"===l?"left":"right",$("DIV.resp-column."+l).append(r);$("DIV.resp-column.nodrag").length&&$("DIV.resp-column.nodrag").find("DIV.resp-box").show()},init:function(){$("DIV#loggedin-frontpage").length,$("P.switch.popup-menu").length&&this.switchToPopup(),/printable/.test(window.location.href)||/grading\/edit/.test(window.location.href)||/attendance\/edit/.test(window.location.href)||this.fixContentHeader(),$("BODY.nobody").length&&$("DIV#l-menu").length||($("DIV#l-menu").find("A, B").on("mousedown",$.proxy(MenuItems.linkDragStart,MenuItems)),$("DIV.dynamic-menu").each(function(){var e=$(this);MenuItems.handleMenuItems($(this)),$(window).on("resize",function(){MenuItems.handleMenuItems(e)})})),$("div.frame-wrapper.correct-top:eq(0)").length&&$("#l-content").addClass("iframe-exists"),this.fixHeaderPosition(),$(window).on("resize scroll",$.proxy(MenuItems.fixHeaderPosition,MenuItems))}};$(function(){MenuItems.init(),$("input.focusonload").length&&$("input.focusonload").focus()});