var WilmaSlider=function(t,e){var s=this;this.settings=$.extend(!0,{},{allowNullValue:!1,ariaLabel:"",nullValueTooltipText:"",customClasses:"",disabled:!1,edges:{show:!1,minString:"",maxString:""},inputId:"",initOnCreate:!0,label:{text:"label",show:!0,showValue:!1},name:"",min:1,max:10,onSlide:null,onChange:null,showValueOnSlider:!1,tooltip:{show:!1,showIfNotChanged:!1,text:""},value:null},e),this.elements={},this.elements.parent=t,this.elements.wrapper=$("<div />").addClass("wilma-slider-wrapper"),this.elements.label=null,this.elements.labelValue=null,this.elements.sliderValue=null,this.elements.value=null,this.elements.edges=null,this.elements.slider=$("<div />").addClass("wilma-slider"),this.elements.input=null,this.elements.tooltip=null,this.elements.tooltipHandle=null,this.lastTooltipText="",this.lastPopoverText="",this.lastValue=-1,this.valueChanged=!1,this.initState=!1,this.settings.showValue&&(this.elements.value=$("<div />")),this.settings.label.show&&(this.elements.label=$("<div />").addClass("wilma-slider-label").text(this.settings.label.text).appendTo(this.elements.wrapper),this.settings.label.showValue)&&(this.elements.label.css("position","relative"),this.elements.labelValue=$("<div />").addClass("wilma-value-text right-absolute").appendTo(this.elements.label)),this.settings.showValueOnSlider&&(this.elements.sliderValue=$("<span />").addClass("slider-value")),(this.elements.wrapper[0].wilmaSlider=this).elements.slider.appendTo(this.elements.wrapper),""!==this.settings.customClasses&&this.elements.wrapper.addClass(this.settings.customClasses),this.settings.edges.show&&(e=this.settings.edges.minString||this.settings.min,t=this.settings.edges.maxString||this.settings.max,this.elements.edges=$("<div />").addClass("clearfix").appendTo(this.elements.wrapper),this.elements.edges.append($("<small />").addClass("pull-left").css("max-width","50%").text(e)),this.elements.edges.append($("<small />").addClass("pull-right").css("max-width","50%").text(t))),this.settings.disabled||(this.elements.input=$("<input />").addClass("wilma-slider-input").attr({type:"hidden"}),""!==this.settings.name&&this.elements.input.attr({name:this.settings.name}),this.elements.input.appendTo(this.elements.wrapper)),this.elements.wrapper.appendTo(this.elements.parent),this.settings.initOnCreate&&this.initSlider(),this.settings.tooltip.show&&(this.elements.tooltip=this.elements.wrapper.find(".slider"),this.elements.tooltipHandle=this.elements.tooltip.find(".slider-handle").not(".hide"),this.elements.tooltip.popover({trigger:"manual",content:" ",placement:"top",container:"body",animation:!1}),this.elements.tooltip.on("mousedown touchstart",function(){s.elements.tooltip.popover("show"),s.updatePopover(),$(document).on("mouseup.wilmaslider touchend.wilmaslider",function(){var t,e=s.elements.tooltip.data("bs.popover");e&&e.$tip&&0<e.$tip.length&&(t=setTimeout(function(){e.$tip.animate({opacity:0},750,function(){s.elements.tooltip.popover("hide"),e.$tip.css("opacity","")}),clearTimeout(t)},250)),$(document).off("mouseup.wilmaslider")})}))};WilmaSlider.prototype.initSlider=function(){var t,s=this,e={min:this.settings.min,max:this.settings.max,ticks_positions:[0,100],ticks:[this.settings.min,this.settings.max],tooltip_position:"bottom"};e.disabled=this.settings.disabled,this.settings.tooltip.show&&(e.formatter=$.proxy(this.getTooltipText,this)),"number"==typeof this.settings.value?(t=this.settings.value,e.value=t,this.settings.label.showValue&&this.elements.labelValue.text(this.settings.value+"/"+this.settings.max)):this.settings.allowNullValue&&null===this.settings.value?this.initState=!(t=null):(t=this.settings.min,this.settings.label.showValue&&this.elements.labelValue.text(this.settings.min+"/"+this.settings.max)),this.settings.disabled||null===t||this.elements.input.val(t),this.initState&&(this.lastTooltipText=this.settings.nullValueTooltipText),this.elements.slider.bootstrapSlider(e),this.settings.disabled&&this.elements.slider.bootstrapSlider("disable"),this.settings.ariaLabel&&this.elements.wrapper.find(".slider-handle").attr("aria-label",this.settings.ariaLabel),this.initState&&this.elements.slider.siblings(".slider").addClass("inited").on("mousedown.sliderwilmainit touchstart.sliderwilmainit",function(){s.initState=!1,$(this).removeClass("inited").off("mousedown.sliderwilmainit touchstart.sliderwilmainit"),s.elements.slider.trigger("change")}),this.settings.disabled||(this.elements.slider.on("change",function(t){var e;"value"in t?e=t.value.newValue:(e=t.target.value,t.value={oldValue:e,newValue:e}),s.lastValue!==e&&(s.elements.input.val(e),s.valueChanged=!0,s.lastValue=e,s.updatePopover(),"function"==typeof s.settings.onChange)&&s.settings.onChange(t,s)}),this.elements.slider.on("slide",function(t){s.lastValue!==t.value&&(s.lastValue=t.value,s.valueChanged=!0,s.elements.input.val(t.value),s.updatePopover(),"function"==typeof s.settings.onSlide)&&s.settings.onSlide(t,s)}))},WilmaSlider.prototype.updatePopover=function(){var t,e;this.settings.tooltip.show&&(e=this.getPopoverText(),t=this.elements.tooltip.data("bs.popover"))&&t.options&&(this.elements.tooltip.popover("hide"),t.options.content=e,t.setContent(),this.elements.tooltip.popover("show"))},WilmaSlider.prototype.getValue=function(){return this.settings.disabled?this.elements.slider.bootstrapSlider("value"):null!==this.elements.input?parseInt(this.elements.input.val(),10):-1},WilmaSlider.prototype.setValue=function(t){this.elements.slider.bootstrapSlider("value",t),this.rePositionSliderValue(t),this.settings.label.showValue&&this.elements.labelValue.text(t+"/"+this.settings.max),null!==this.elements.sliderValue&&(-1===t||null===t?this.elements.sliderValue.text("-/"+this.settings.max):this.elements.sliderValue.text(t+"/"+this.settings.max)),this.settings.disabled||null!==this.elements.input&&this.elements.input.val(t)},WilmaSlider.prototype.getTooltipText=function(){var t;return this.initState||(t=this.getValue(),this.lastTooltipText=-1<t?t:""),this.lastTooltipText},WilmaSlider.prototype.getPopoverText=function(){return this.valueChanged&&!this.initState||this.settings.tooltip.showIfNotChanged?(this.valueChanged=!1,this.lastPopoverText="function"==typeof this.settings.tooltip.text?this.settings.tooltip.text(this):this.settings.tooltip.text,this.lastPopoverText):""},WilmaSlider.prototype.rePositionSliderValue=function(t){var e,s=this.settings.max-this.settings.min;if(!this.settings.showValueOnSlider)return!1;.5<(s=((t=-1===t?this.settings.min:t)-this.settings.min)/s)&&null!==t?(e=(1-s)*this.elements.slider.width()+emToPx(1.5),this.elements.sliderValue.css({left:"auto",right:e})):(e=(0<=s?s:0)*this.elements.slider.width()+emToPx(1.5),this.elements.sliderValue.css({right:"auto",left:e}))},$(window).on("resize.wilmaslider",function(){var t=$("div.wilma-slider-wrapper");0<t.length&&t.each(function(){this.wilmaSlider.rePositionSliderValue(this.wilmaSlider.getValue())})});